.PHONY: help install run download-samples clean format lint test setup check

# Default target
help:
	@echo "DSPy Invoice Parser - Available commands:"
	@echo ""
	@echo "  make setup          - Install dependencies with uv"
	@echo "  make install        - Alias for setup"
	@echo "  make run            - Run the Streamlit app"
	@echo "  make download-samples - Download/create sample invoices"
	@echo "  make clean          - Clean temporary files and directories"
	@echo "  make format         - Format code with black and isort"
	@echo "  make lint           - Run linters (mypy, black, isort)"
	@echo "  make test           - Run tests"
	@echo "  make check          - Run all checks (format, lint, test)"
	@echo "  make help           - Show this help message"
	@echo ""

# Install dependencies
setup install:
	@echo "ğŸ“¦ Installing dependencies..."
	uv sync
	@echo "âœ… Dependencies installed"

# Run the Streamlit app
run:
	@echo "ğŸš€ Starting Streamlit app..."
	@echo "   App will be available at http://localhost:8501"
	uv run streamlit run src/invoice_parser_ui/app.py

# Download/create sample invoices
download-samples:
	@echo "ğŸ“¥ Creating sample invoices..."
	uv run python scripts/download_sample_invoices.py
	@echo "âœ… Sample invoices created in data/"

# Clean temporary files
clean:
	@echo "ğŸ§¹ Cleaning temporary files..."
	rm -rf temp/
	rm -rf reports/
	rm -rf .sprint/
	rm -rf __pycache__/
	find . -type d -name "__pycache__" -exec rm -r {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.pyo" -delete 2>/dev/null || true
	find . -type f -name ".DS_Store" -delete 2>/dev/null || true
	@echo "âœ… Clean complete"

# Format code
format:
	@echo "ğŸ¨ Formatting code..."
	uv run black src/ scripts/
	uv run isort src/ scripts/
	@echo "âœ… Formatting complete"

# Run linters
lint:
	@echo "ğŸ” Running linters..."
	uv run black --check src/ scripts/ || echo "âš ï¸  Black found formatting issues"
	uv run isort --check src/ scripts/ || echo "âš ï¸  isort found import ordering issues"
	uv run mypy src/ || echo "âš ï¸  mypy found type checking issues"
	@echo "âœ… Linting complete"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	uv run pytest tests/ -v || echo "âš ï¸  Some tests failed"
	@echo "âœ… Testing complete"

# Run all checks
check: format lint test
	@echo "âœ… All checks complete"

# Setup everything (install + download samples)
setup-all: setup download-samples
	@echo "âœ… Setup complete - ready to run!"

